# 模块化架构中的代码复用问题

模块化架构的核心思想是将不同的逻辑封装成一个个单独的模块。当不同的模块中包含相同的逻辑时，通常是将其抽离出来构建成一个单独的模块进行调用，以实现代码复用。

但是如果该模块的设计不当，在某些场景下，这种方法会导致耦合，并降低模块的内聚性(增加了额外依赖)，比如有 B, C, D 三个模块都依赖于 A, 现在有一个模块 F 也依赖于 A，但是 A 的功能无法满足，这时有两个方案：

1. 修改 A 的逻辑以适应 F 的需求，但是由于 B，C，D 都依赖于 A，对 A 的修改可能对之前的模块产生不可预期的影响。
2. 构建基于 A 的扩展 A1 来满足 F 的需求。但是这种方案的问题在于如果又有一个模块无法适应的化，又需要重写扩展。

其实还有一个方法，就是直接用复制来进行代码复用，咋的一看可能觉得不是很合理，但如果 A 的逻辑并不复杂，完全可以将这段逻辑聚合到各个依赖模块中，虽然导致了冗余代码，但提高的模块的内聚性。

需要注意的是，上述方法只适用于某些特定场景，如果 A 模块的设计合理，完全可以采用更好的方法来解决上述问题。

有一个比较类似的应用场景是在大规模数据采集中的解析模块设计，由于不同网站的数据页面的结构差异，数据解析模块即需要又较强的扩展能力，同时又需要一定的通用性来进行代码复用。

通常的方式是构建一个解析器基类，在里面提供一系列的公共方法，并在子类中对其进行重写来满足扩展需求。然后通过不同的子类来进行复用。但是这种方案的问题在于，每当需求不满足时就通过新的扩展子类来实现，当类的继承结构过于复杂时，整个解析模块会变得越来越复杂。

另一个思路是采用组件化的设计思路，基类只作为一个框架，其内部提供一系列的 *插槽*，依赖模块通过自定义组件来构建具体实例。即可以通过组件来复用，又通过不同组件的自定义组合来满足扩展需求。